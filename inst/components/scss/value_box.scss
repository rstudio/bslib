$bslib-value-box-enable-border: "auto" !default; // "auto" | "never" | "always"
$bslib-value-box-enable-shadow: $enable-shadows !default;
$bslib-value-box-horizontal-min-width: 300px;

// CSS variables that start with --- (3 dashes instead of 2) are private vars
// that are set by user arguments in the R calls. The CSS properties below only
// apply to the default value box style; the standard way to theme individual
// value boxes is with CSS classes on the value box container.
// :root {
//   --bslib-value-box-fg:;
//   --bslib-value-box-bg:;
//   --bslib-value-box-border-color:;
//   --bslib-value-box-border-width:;
// }

.bslib-value-box {
  @if ($bslib-value-box-enable-shadow) {
    box-shadow: $box-shadow;
  }

  &.default {
    --bslib-value-box-fg-default: var(--bs-card-color, var(--bs-body-color, var(--#{$prefix}body-color)));
    --bslib-value-box-bg-default: var(--bs-card-bg, var(--bs-body-bg, var(--#{$prefix}body-bg)));
    --bslib-value-box-border-color-default: var(--bs-card-border-color, #{$card-border-color});
    --bslib-value-box-border-width-default: var(--bs-card-border-width, #{$card-border-width});
    color: var(--bslib-value-box-fg, var(--bslib-value-box-fg-default));
    background-color: var(--bslib-value-box-bg, var(--bslib-value-box-bg-default));
    border-color: var(--bslib-value-box-border-color, var(--bslib-value-box-border-color-default));
    border-width: var(--bslib-value-box-border-width, var(--bslib-value-box-border-width-default));
  }

  container-name: bslib-value-box;
  container-type: inline-size;

  .value-box-grid {
    grid-template-areas: "left right";
    align-items: center;
  }
  .value-box-grid > :first-child { // showcase_container
    height: 100%;
    max-height: var(---bslib-value-box-showcase-max-h, 100%);
  }
  &[data-full-screen="true"] .value-box-grid > :first-child { // showcase full screen
    height: 100%;
    max-height: var(---bslib-value-box-showcase-max-h-fs, 100%);
  }

  @media screen and (min-width: breakpoint-max(sm, $grid-breakpoints)) {
    @container bslib-value-box (max-width: #{$bslib-value-box-horizontal-min-width}) {
      &:not(.showcase-bottom) .value-box-grid {
        // override specificity of showcase layouts for small value boxes
        grid-template-columns: 1fr !important;
        grid-template-rows: auto auto;
        grid-template-areas:
          "top"
          "bottom";

        > :first-child { // showcase
          grid-area: top !important;
        }
        > :last-child { // contents
          grid-area: bottom !important;
        }

        .value-box-area {
          justify-content: end;
        }
      }
    }
  }

  // Should also be fillable/fill (i.e., d-flex; flex: 1)
  .value-box-area {
    justify-content: center;
    padding: 1.5rem 1rem;
    font-size: .9rem;
    font-weight: 500;
    * {
      color: inherit;
      margin-bottom: 0;
      margin-top: 0;
    }
  }

  .value-box-title {
    @include bootstrap-heading($h6-font-size);
    color: inherit;
    // add a non-breaking space to ensure it's not 0 height
    &:empty::after {
      content: '\00a0 '
    }
  }

  .value-box-value {
    @include bootstrap-heading($h2-font-size);
    color: inherit;
    // add a non-breaking space to ensure it's not 0 height
    &:empty::after {
      content: '\00a0 '
    }
  }

  // Should also be fillable/fill (i.e., d-flex; flex: 1)
  .value-box-showcase {
    align-items: center;
    justify-content: center;
    margin-top: auto;
    margin-bottom: auto;
    padding: 1rem;
    overflow: hidden;

    .bi, .fa {
      opacity: .85;
      min-width: 50px;
      max-width: 125%;
    }
    // We set font size because {bsicons}/{fontawesome} both
    // set height/width to 1em by default (as an inline style)
    .bi { font-size: 5rem; }
    .fa { font-size: 4rem; }
  }


  &.showcase-top-right {
    .value-box-grid {
      grid-template-columns: 1fr var(---bslib-value-box-showcase-w, 50%);

      > :first-child { // showcase_container
        grid-area: right;
        margin-left: auto;
        align-self: start;
      }

      > :nth-child(2) { // contents
        grid-area: left;
        align-self: end;
      }
    }

    &[data-full-screen="true"] {
      .value-box-grid {
        grid-template-columns: auto var(---bslib-value-box-showcase-w-fs, 1fr);
        > :nth-child(2) { // contents
          align-self: center;
        }
      }
    }

    .value-box-showcase {
      align-items: end;
      padding-left: 0;
      padding-bottom: 0;
    }

    &:not([data-full-screen="true"]) {
      .value-box-showcase {
        margin-top: 0;
        overflow: visible;
      }

      @container bslib-value-box (max-width: 300px) {
        .value-box-grid {
          .value-box-showcase { // reset padding on showcase_container
            padding-left: 1rem;
          }
        }
      }
    }
  }

  &.showcase-left-center {
    .value-box-grid {
      grid-template-columns: var(---bslib-value-box-showcase-w, 30%) auto;
    }

    &[data-full-screen="true"] .value-box-grid {
      grid-template-columns: var(---bslib-value-box-showcase-w-fs, 1fr) auto;
    }

    &:not([data-fill-screen="true"]) {
      .value-box-grid {
        & > :first-child { // showcase_container
          grid-area: left;
        }

        & > :nth-child(2) { // contents
          grid-area: right;
        }
      }
    }
  }

  &.showcase-bottom {
    .value-box-grid {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr var(---bslib-value-box-showcase-h, auto);
      grid-template-areas:
          "top"
          "bottom";
      overflow: hidden;
      > :first-child {
        grid-area: bottom;
      }
      > :last-child {
        grid-area: top;
      }
    }
    .value-box-showcase {
        padding: 0;
        margin: 0;
    }
    &[data-full-screen="true"] {
      .value-box-grid {
        grid-template-rows: 1fr var(---bslib-value-box-showcase-h-fs, 2fr);
      }
      .value-box-showcase {
        padding: 1rem;
      }
    }
  }
}

@if ($bslib-value-box-enable-border == "never") {
  .bslib-value-box {
    border: 0;
  }
}
@else if ($bslib-value-box-enable-border == "auto") {
  @if $bslib-value-box-enable-shadow {
    .bslib-value-box {
      border: 0;
    }
  } @else {
    .bslib-value-box:not(.border-auto) {
      border: 0;
    }
  }
}

// Override layout_inline_grid()'s preference to collapse to full-width on mobile (inside the value box)
@include media-breakpoint-down(sm) {
  .bslib-value-box.showcase-left-center .value-box-grid {
    grid-template-columns: var(---bslib-value-box-showcase-w, 30%) auto !important;
  }
  .bslib-value-box.showcase-top-right .value-box-grid {
    grid-template-columns: auto var(---bslib-value-box-showcase-w, 50%) !important;
  }
}
