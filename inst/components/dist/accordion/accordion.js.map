{
  "version": 3,
  "sources": ["../../../../srcts/src/components/_utils.ts", "../../../../srcts/src/components/accordion.ts"],
  "sourcesContent": ["import type { HtmlDep } from \"rstudio-shiny/srcts/types/src/shiny/render\";\n\nimport type { InputBinding as InputBindingType } from \"rstudio-shiny/srcts/types/src/bindings/input\";\n\n// Exclude undefined from T\ntype NotUndefined<T> = T extends undefined ? never : T;\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst InputBinding = (\n  window.Shiny ? Shiny.InputBinding : class {}\n) as typeof InputBindingType;\n\nfunction registerBinding(\n  inputBindingClass: new () => InputBindingType,\n  name: string\n): void {\n  if (window.Shiny) {\n    Shiny.inputBindings.register(new inputBindingClass(), \"bslib.\" + name);\n  }\n}\n\n// Return true if the key exists on the object and the value is not undefined.\n//\n// This method is mainly used in input bindings' `receiveMessage` method.\n// Since we know that the values are sent by Shiny via `{jsonlite}`,\n// then we know that there are no `undefined` values. `null` is possible, but not `undefined`.\nfunction hasDefinedProperty<\n  Prop extends keyof X,\n  X extends { [key: string]: any }\n>(\n  obj: X,\n  prop: Prop\n): obj is X & { [key in NonNullable<Prop>]: NotUndefined<X[key]> } {\n  return (\n    Object.prototype.hasOwnProperty.call(obj, prop) && obj[prop] !== undefined\n  );\n}\n\n// TODO: Shiny should trigger resize events when the output\n// https://github.com/rstudio/shiny/pull/3682\nfunction doWindowResizeOnElementResize(el: HTMLElement): void {\n  if ($(el).data(\"window-resize-observer\")) {\n    return;\n  }\n  const resizeEvent = new Event(\"resize\");\n  const ro = new ResizeObserver(() => {\n    window.dispatchEvent(resizeEvent);\n  });\n  ro.observe(el);\n  $(el).data(\"window-resize-observer\", ro);\n}\n\nfunction getAllFocusableChildren(el: HTMLElement): HTMLElement[] {\n  // Cross-referenced with https://allyjs.io/data-tables/focusable.html\n  const base = [\n    \"a[href]\",\n    \"area[href]\",\n    \"button\",\n    \"details summary\",\n    \"input\",\n    \"iframe\",\n    \"select\",\n    \"textarea\",\n    '[contentEditable=\"\"]',\n    '[contentEditable=\"true\"]',\n    '[contentEditable=\"TRUE\"]',\n    \"[tabindex]\",\n  ];\n  const modifiers = [':not([tabindex=\"-1\"])', \":not([disabled])\"];\n  const selectors = base.map((b) => b + modifiers.join(\"\"));\n  const focusable = el.querySelectorAll(selectors.join(\", \"));\n  return Array.from(focusable) as HTMLElement[];\n}\n\nexport {\n  InputBinding,\n  registerBinding,\n  hasDefinedProperty,\n  doWindowResizeOnElementResize,\n  getAllFocusableChildren,\n};\nexport type { HtmlDep };\n", "import type { HtmlDep } from \"./_utils\";\nimport { InputBinding, registerBinding, hasDefinedProperty } from \"./_utils\";\n\ntype AccordionItem = {\n  item: HTMLElement;\n  value: string;\n  isOpen: () => boolean;\n  show: () => void;\n  hide: () => void;\n};\n\ntype HTMLContent = {\n  html: string;\n  deps?: HtmlDep[];\n};\n\ntype SetMessage = {\n  method: \"set\";\n  values: string[];\n};\n\ntype OpenMessage = {\n  method: \"open\";\n  values: string[] | true;\n};\n\ntype CloseMessage = {\n  method: \"close\";\n  values: string[] | true;\n};\n\ntype InsertMessage = {\n  method: \"insert\";\n  panel: HTMLContent;\n  target: string;\n  position: \"after\" | \"before\";\n};\n\ntype RemoveMessage = {\n  method: \"remove\";\n  target: string[];\n};\n\ntype UpdateMessage = {\n  method: \"update\";\n  target: string;\n  value: string;\n  body: HTMLContent;\n  title: HTMLContent;\n  icon: HTMLContent;\n};\n\ntype MessageData =\n  | CloseMessage\n  | InsertMessage\n  | OpenMessage\n  | RemoveMessage\n  | SetMessage\n  | UpdateMessage;\n\nclass AccordionInputBinding extends InputBinding {\n  find(scope: HTMLElement) {\n    return $(scope).find(\".accordion.bslib-accordion-input\");\n  }\n\n  getValue(el: HTMLElement): string[] | null {\n    const items = this._getItemInfo(el);\n    const selected = items.filter((x) => x.isOpen()).map((x) => x.value);\n    return selected.length === 0 ? null : selected;\n  }\n\n  subscribe(el: HTMLElement, callback: (x: boolean) => void) {\n    $(el).on(\n      \"shown.bs.collapse.accordionInputBinding hidden.bs.collapse.accordionInputBinding\",\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      function (event) {\n        callback(true);\n      }\n    );\n  }\n\n  unsubscribe(el: HTMLElement) {\n    $(el).off(\".accordionInputBinding\");\n  }\n\n  receiveMessage(el: HTMLElement, data: MessageData) {\n    const method = data.method;\n    if (method === \"set\") {\n      this._setItems(el, data);\n    } else if (method === \"open\") {\n      this._openItems(el, data);\n    } else if (method === \"close\") {\n      this._closeItems(el, data);\n    } else if (method === \"remove\") {\n      this._removeItem(el, data);\n    } else if (method === \"insert\") {\n      this._insertItem(el, data);\n    } else if (method === \"update\") {\n      this._updateItem(el, data);\n    } else {\n      throw new Error(`Method not yet implemented: ${method}`);\n    }\n  }\n\n  protected _setItems(el: HTMLElement, data: SetMessage) {\n    const items = this._getItemInfo(el);\n    const vals = this._getValues(el, items, data.values);\n    items.forEach((x) => {\n      vals.indexOf(x.value) > -1 ? x.show() : x.hide();\n    });\n  }\n\n  protected _openItems(el: HTMLElement, data: OpenMessage) {\n    const items = this._getItemInfo(el);\n    const vals = this._getValues(el, items, data.values);\n    items.forEach((x) => {\n      if (vals.indexOf(x.value) > -1) x.show();\n    });\n  }\n\n  protected _closeItems(el: HTMLElement, data: CloseMessage) {\n    const items = this._getItemInfo(el);\n    const vals = this._getValues(el, items, data.values);\n    items.forEach((x) => {\n      if (vals.indexOf(x.value) > -1) x.hide();\n    });\n  }\n\n  protected _insertItem(el: HTMLElement, data: InsertMessage) {\n    let targetItem = this._findItem(el, data.target);\n\n    // If no target was specified, or the target was not found, then default\n    // to the first or last item, depending on the position\n    if (!targetItem) {\n      targetItem = (\n        data.position === \"before\" ? el.firstElementChild : el.lastElementChild\n      ) as HTMLElement;\n    }\n\n    const panel = data.panel;\n\n    // If there is still no targetItem, then there are no items in the accordion\n    if (targetItem) {\n      Shiny.renderContent(\n        targetItem,\n        panel,\n        data.position === \"before\" ? \"beforeBegin\" : \"afterEnd\"\n      );\n    } else {\n      Shiny.renderContent(el, panel);\n    }\n\n    // Need to add a reference to the parent id that makes autoclose to work\n    if (this._isAutoClosing(el)) {\n      const val = $(panel.html).attr(\"data-value\");\n      $(el)\n        .find(`[data-value=\"${val}\"] .accordion-collapse`)\n        .attr(\"data-bs-parent\", \"#\" + el.id);\n    }\n  }\n\n  protected _removeItem(el: HTMLElement, data: RemoveMessage) {\n    const targetItems = this._getItemInfo(el).filter(\n      (x) => data.target.indexOf(x.value) > -1\n    );\n\n    const unbindAll = Shiny?.unbindAll;\n\n    targetItems.forEach((x) => {\n      if (unbindAll) unbindAll(x.item);\n      x.item.remove();\n    });\n  }\n\n  protected _updateItem(el: HTMLElement, data: UpdateMessage) {\n    const target = this._findItem(el, data.target);\n\n    if (!target) {\n      throw new Error(\n        `Unable to find an accordion_panel() with a value of ${data.target}`\n      );\n    }\n\n    if (hasDefinedProperty(data, \"value\")) {\n      target.dataset.value = data.value;\n    }\n\n    if (hasDefinedProperty(data, \"body\")) {\n      const body = target.querySelector(\".accordion-body\") as HTMLElement; // always exists\n      Shiny.renderContent(body, data.body);\n    }\n\n    const header = target.querySelector(\".accordion-header\") as HTMLElement; // always exists\n\n    if (hasDefinedProperty(data, \"title\")) {\n      const title = header.querySelector(\".accordion-title\") as HTMLElement; // always exists\n      Shiny.renderContent(title, data.title);\n    }\n\n    if (hasDefinedProperty(data, \"icon\")) {\n      const icon = header.querySelector(\n        \".accordion-button > .accordion-icon\"\n      ) as HTMLElement; // always exists\n      Shiny.renderContent(icon, data.icon);\n    }\n  }\n\n  protected _getItemInfo(el: HTMLElement): AccordionItem[] {\n    const items = Array.from(\n      el.querySelectorAll(\":scope > .accordion-item\")\n    ) as HTMLElement[];\n    return items.map((x) => this._getSingleItemInfo(x));\n  }\n\n  protected _getSingleItemInfo(x: HTMLElement): AccordionItem {\n    const collapse = x.querySelector(\".accordion-collapse\") as HTMLElement;\n    const isOpen = () => $(collapse).hasClass(\"show\");\n    return {\n      item: x,\n      value: x.dataset.value as string,\n      isOpen: isOpen,\n      show: () => {\n        if (!isOpen()) $(collapse).collapse(\"show\");\n      },\n      hide: () => {\n        if (isOpen()) $(collapse).collapse(\"hide\");\n      },\n    };\n  }\n\n  protected _getValues(\n    el: HTMLElement,\n    items: AccordionItem[],\n    values: string[] | true\n  ): string[] {\n    let vals = values !== true ? values : items.map((x) => x.value);\n    const autoclose = this._isAutoClosing(el);\n    if (autoclose) {\n      vals = vals.slice(vals.length - 1, vals.length);\n    }\n    return vals;\n  }\n\n  protected _findItem(el: HTMLElement, value: string): HTMLElement | null {\n    return el.querySelector(`[data-value=\"${value}\"]`);\n  }\n\n  protected _isAutoClosing(el: HTMLElement): boolean {\n    return el.classList.contains(\"autoclose\");\n  }\n}\n\nregisterBinding(AccordionInputBinding, \"accordion\");\n"],
  "mappings": "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",
  "names": []
}
