/*! bslib 0.9.0.9002 | (c) 2012-2025 RStudio, PBC. | License: MIT + file LICENSE */
var u=(n,t,e)=>new Promise((i,o)=>{var r=d=>{try{a(e.next(d))}catch(l){o(l)}},s=d=>{try{a(e.throw(d))}catch(l){o(l)}},a=d=>d.done?i(d.value):Promise.resolve(d.value).then(r,s);a((e=e.apply(n,t)).next())});var h=window.Shiny,v=h?h.InputBinding:class{};function C(n,t){h&&h.inputBindings.register(new n,"bslib."+t)}function c(n,t){return Object.prototype.hasOwnProperty.call(n,t)&&n[t]!==void 0}var B="sql",L=2,x="github-light",U="github-dark",D=400,T=new Set,k=new WeakSet,E=null;function y(){if(E!==null)return E;let n=document.querySelector('script[src*="prism-code-editor"][src$="index.js"]');if(!n)throw new Error("Could not find prism-code-editor script element. Ensure the prism-code-editor dependency is properly loaded.");let t=n.getAttribute("src");if(!t)throw new Error("prism-code-editor script element has no src attribute");return E=new URL(t,document.baseURI).href.replace(/\/index\.js$/,""),E}function M(n,t){return u(this,null,function*(){if(T.has(n)||["plain","plaintext","text","txt"].includes(n))return;let e=n;n==="html"&&(e="markup");try{yield import(`${t}/prism/languages/${e}.js`),T.add(n)}catch(i){throw console.error(`Failed to load language '${n}':`,i),i}})}function P(n,t,e){let i=`code-editor-theme-${n}`,o=document.getElementById(i),r=document.createElement("link");r.id=i,r.rel="stylesheet",r.href=`${e}/themes/${t}.css`;let s=()=>{o==null||o.remove()};r.addEventListener("load",s),r.addEventListener("error",()=>{console.error(`Failed to load code editor theme: ${t}`),s()}),document.head.appendChild(r)}function A(n,t,e,i){let o=n.id,r=()=>{let l=document.documentElement.getAttribute("data-bs-theme")==="dark"?n.dataset.themeDark||e:n.dataset.themeLight||t;P(o,l,i)};r();let s=new MutationObserver(()=>r());s.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),n.darkLightObserver=s}function F(n){return u(this,null,function*(){if(k.has(n))return n.prismEditor;let t=n.querySelector(".code-editor");if(!t){console.error("Could not find .code-editor inside .shiny-input-code-editor");return}let e=n.dataset.language||B,i=n.dataset.initialCode||"",o=n.dataset.themeLight||x,r=n.dataset.themeDark||U,s=n.dataset.readOnly==="true",a=n.dataset.lineNumbers!=="false",d=n.dataset.wordWrap==="true",l=parseInt(n.dataset.tabSize||String(L))||L,S=n.dataset.insertSpaces!=="false",m=y();yield M(e,m);let[{createEditor:_},{copyButton:O},{defaultCommands:z}]=yield Promise.all([import(`${m}/index.js`),import(`${m}/extensions/copyButton/index.js`),import(`${m}/extensions/commands.js`)]),p=_(t,{language:e,value:i,tabSize:l,insertSpaces:S,lineNumbers:a,wordWrap:d,readOnly:s},O(),z()),g=p.keyCommandMap.Enter;p.keyCommandMap.Enter=(b,H,I)=>b.metaKey||b.ctrlKey?(n.dispatchEvent(new CustomEvent("codeEditorUpdate")),t.classList.add("code-editor-submit-flash"),setTimeout(()=>{t.classList.remove("code-editor-submit-flash")},D),!0):g==null?void 0:g(b,H,I),n.prismEditor=p,k.add(n),A(n,o,r,m);let w=n.querySelector("textarea");return w&&w.addEventListener("blur",()=>{n.dispatchEvent(new CustomEvent("codeEditorUpdate"))}),p})}var f=class extends v{find(t){return $(t).find(".shiny-input-code-editor")}getValue(t){let e=t;return e.prismEditor?e.prismEditor.value:t.dataset.initialCode||""}setValue(t,e){let i=t;i.prismEditor?i.prismEditor.setOptions({value:e}):t.dataset.initialCode=e}subscribe(t,e){let i=t;i.isInitialized=F(i),i.isInitialized.then(()=>{e(!1)}).catch(r=>{console.error("Failed to initialize code editor:",r)});let o=()=>e(!0);t.addEventListener("codeEditorUpdate",o),i.codeEditorUpdateCallback=o}unsubscribe(t){var r;let e=t,i=e.codeEditorUpdateCallback;i&&(t.removeEventListener("codeEditorUpdate",i),delete e.codeEditorUpdateCallback),e.darkLightObserver&&(e.darkLightObserver.disconnect(),delete e.darkLightObserver);let o=`code-editor-theme-${t.id}`;(r=document.getElementById(o))==null||r.remove()}receiveMessage(t,e){return u(this,null,function*(){let i=t;i.isInitialized&&(yield i.isInitialized);let o=i.prismEditor;if(!o){console.warn("Cannot update code editor: editor not initialized");return}let r={};if(c(e,"code")&&(r.value=e.code),c(e,"tab_size")&&(r.tabSize=e.tab_size),c(e,"indentation")&&(r.insertSpaces=e.indentation==="space"),c(e,"read_only")&&(r.readOnly=e.read_only),c(e,"line_numbers")&&(r.lineNumbers=e.line_numbers),c(e,"word_wrap")&&(r.wordWrap=e.word_wrap),Object.keys(r).length>0&&o.setOptions(r),c(e,"language")&&e.language){let s=e.language;if(s!==t.dataset.language){let a=y();try{yield M(s,a),t.dataset.language=s,o.setOptions({language:s}),o.update()}catch(d){console.error(`Failed to change language to '${s}':`,d)}}}c(e,"theme_light")&&e.theme_light&&this._maybeLoadThemeForMode(t,e.theme_light,"themeLight",!1),c(e,"theme_dark")&&e.theme_dark&&this._maybeLoadThemeForMode(t,e.theme_dark,"themeDark",!0),t.dispatchEvent(new CustomEvent("codeEditorUpdate"))})}_maybeLoadThemeForMode(t,e,i,o){if(t.dataset[i]=e,document.documentElement.getAttribute("data-bs-theme")==="dark"===o){let a=y();P(t.id,e,a)}}getRatePolicy(){return{policy:"throttle",delay:300}}};C(f,"code-editor");
//# sourceMappingURL=code-editor.min.js.map
