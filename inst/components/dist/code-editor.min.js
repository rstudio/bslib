/*! bslib 0.9.0.9002 | (c) 2012-2025 RStudio, PBC. | License: MIT + file LICENSE */
var A=(s,r,e)=>{if(!r.has(s))throw TypeError("Cannot "+e)};var m=(s,r,e)=>(A(s,r,"read from private field"),e?e.call(s):r.get(s)),g=(s,r,e)=>{if(r.has(s))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(s):r.set(s,e)},U=(s,r,e,t)=>(A(s,r,"write to private field"),t?t.call(s,e):r.set(s,e),e);var h=(s,r,e)=>(A(s,r,"access private method"),e);var b=(s,r,e)=>new Promise((t,i)=>{var n=u=>{try{c(e.next(u))}catch(E){i(E)}},d=u=>{try{c(e.throw(u))}catch(E){i(E)}},c=u=>u.done?t(u.value):Promise.resolve(u.value).then(n,d);c((e=e.apply(s,r)).next())});function B(s,{type:r=null}={}){if(!window.Shiny)return;class e extends window.Shiny.InputBinding{constructor(){super()}find(i){return $(i).find(s)}getValue(i){return"getValue"in i?i.getValue():i.value}getType(i){return r}subscribe(i,n){i.onChangeCallback=n}unsubscribe(i){i.onChangeCallback=n=>{}}receiveMessage(i,n){i.receiveMessage(i,n)}}window.Shiny.inputBindings.register(new e,`${s}-Binding`)}var N=window.Shiny,Z=N?N.InputBinding:class{};function v({headline:s="",message:r,status:e="warning"}){document.dispatchEvent(new CustomEvent("shiny:client-message",{detail:{headline:s,message:r,status:e}}))}function l(s,r){return Object.prototype.hasOwnProperty.call(s,r)&&s[r]!==void 0}var q="sql",I=2,K="github-light",X="github-dark",J=400,w,y,p,f,S,C,x,k,z,o=class extends HTMLElement{constructor(){super(...arguments);this.onChangeCallback=()=>{}}get language(){var e;return(e=this.getAttribute("language"))!=null?e:q}set language(e){this.setAttribute("language",e)}get readonly(){return this.hasAttribute("readonly")&&this.getAttribute("readonly")!=="false"}set readonly(e){this.setAttribute("readonly",String(e))}get lineNumbers(){return this.getAttribute("line-numbers")!=="false"}set lineNumbers(e){this.setAttribute("line-numbers",String(e))}get wordWrap(){return this.getAttribute("word-wrap")==="true"}set wordWrap(e){this.setAttribute("word-wrap",String(e))}get tabSize(){let e=this.getAttribute("tab-size"),t=e?parseInt(e):I;return isNaN(t)?I:t}set tabSize(e){this.setAttribute("tab-size",String(e))}get insertSpaces(){return this.getAttribute("insert-spaces")!=="false"}set insertSpaces(e){this.setAttribute("insert-spaces",String(e))}get themeLight(){var e;return(e=this.getAttribute("theme-light"))!=null?e:K}set themeLight(e){this.setAttribute("theme-light",e)}get themeDark(){var e;return(e=this.getAttribute("theme-dark"))!=null?e:X}set themeDark(e){this.setAttribute("theme-dark",e)}get value(){var e,t;return(t=(e=this.prismEditor)==null?void 0:e.value)!=null?t:""}set value(e){this.prismEditor&&this.prismEditor.setOptions({value:e})}getValue(){return this.value}connectedCallback(){if(this.prismEditor)return;this.initPromise=this._initializeEditor(),this.initPromise.then(()=>{this.onChangeCallback(!1)}).catch(t=>{v({headline:"Code Editor Initialization Error",message:"An error occurred while initializing the code editor. See console for details.",status:"error"}),console.error("Failed to initialize code editor:",t)});let e=()=>this.onChangeCallback(!0);this.addEventListener("codeEditorUpdate",e)}disconnectedCallback(){var e;(e=this.darkLightObserver)==null||e.disconnect(),this.darkLightObserver=void 0}attributeChangedCallback(e,t,i){if(t===i||!this.prismEditor)return;let n=this.prismEditor;switch(e){case"language":i&&(this.languageChangePromise=this._handleLanguageChange(i));break;case"readonly":n.setOptions({readOnly:i==="true"});break;case"line-numbers":n.setOptions({lineNumbers:i!=="false"});break;case"word-wrap":n.setOptions({wordWrap:i==="true"});break;case"tab-size":{let d=i?parseInt(i):I;isNaN(d)||n.setOptions({tabSize:d});break}case"insert-spaces":n.setOptions({insertSpaces:i!=="false"});break;case"theme-light":i&&this._maybeLoadThemeForMode(i,!1);break;case"theme-dark":i&&this._maybeLoadThemeForMode(i,!0);break;default:break}}_initializeEditor(){return b(this,null,function*(){var O,H,D;let e=this.querySelector(".code-editor");if(!e){v({headline:"Code Editor Initialization Error",message:"Expected to find `.code-editor` inside `<bslib-code-editor>` container element.",status:"error"});return}let t=this.language,i=(O=this.getAttribute("value"))!=null?O:"";this.removeAttribute("value");let n=this.readonly,d=this.lineNumbers,c=this.wordWrap,u=this.tabSize,E=this.insertSpaces,L=h(H=o,f,S).call(H);yield h(D=o,C,x).call(D,t);let[{createEditor:F},{copyButton:R},{defaultCommands:W}]=yield Promise.all([import(`${L}/index.js`),import(`${L}/extensions/copyButton/index.js`),import(`${L}/extensions/commands.js`)]),T=F(e,{language:t,value:i,tabSize:u,insertSpaces:E,lineNumbers:d,wordWrap:c,readOnly:n},R(),W()),M=T.keyCommandMap.Enter;T.keyCommandMap.Enter=(P,j,G)=>P.metaKey||P.ctrlKey?(this.dispatchEvent(new CustomEvent("codeEditorUpdate")),e.classList.add("code-editor-submit-flash"),setTimeout(()=>{e.classList.remove("code-editor-submit-flash")},J),!0):M==null?void 0:M(P,j,G),this.prismEditor=T,this.darkLightObserver=this._setupThemeWatcher();let _=this.querySelector("textarea");return _&&_.addEventListener("blur",()=>{this.dispatchEvent(new CustomEvent("codeEditorUpdate"))}),T})}_setupThemeWatcher(){let e=()=>{var c;let d=document.documentElement.getAttribute("data-bs-theme")==="dark"?this.themeDark:this.themeLight;h(c=o,k,z).call(c,d)};e();let t=new MutationObserver(()=>e());return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),t}_handleLanguageChange(e){return b(this,null,function*(){var i;let t=this.prismEditor;if(t)try{yield h(i=o,C,x).call(i,e),t.setOptions({language:e}),t.update()}catch(n){v({headline:"Code Editor Language Load Error",message:`Failed to load language '${e}'. See console for details.`,status:"error"}),console.error(`Failed to load language '${e}':`,n)}})}receiveMessage(e,t){return b(this,null,function*(){var i;if(this.initPromise&&(yield this.initPromise),!this.prismEditor){v({headline:"Code Editor could not update",message:"An update was ignored because the editor is not yet initialized.",status:"warning"});return}l(t,"value")&&(this.value=(i=t.value)!=null?i:""),l(t,"tab_size")&&t.tab_size!==void 0&&(this.tabSize=t.tab_size),l(t,"indentation")&&(this.insertSpaces=t.indentation==="space"),l(t,"read_only")&&t.read_only!==void 0&&(this.readonly=t.read_only),l(t,"line_numbers")&&t.line_numbers!==void 0&&(this.lineNumbers=t.line_numbers),l(t,"word_wrap")&&t.word_wrap!==void 0&&(this.wordWrap=t.word_wrap),l(t,"language")&&t.language&&(this.language=t.language,this.languageChangePromise&&(yield this.languageChangePromise,this.languageChangePromise=void 0)),l(t,"theme_light")&&t.theme_light&&(this.themeLight=t.theme_light),l(t,"theme_dark")&&t.theme_dark&&(this.themeDark=t.theme_dark),this.dispatchEvent(new CustomEvent("codeEditorUpdate"))})}_maybeLoadThemeForMode(e,t){var n;document.documentElement.getAttribute("data-bs-theme")==="dark"===t&&h(n=o,k,z).call(n,e)}},a=o;w=new WeakMap,y=new WeakMap,p=new WeakMap,f=new WeakSet,S=function(){if(m(o,p)!==null)return m(o,p);let e=document.querySelector('script[src*="prism-code-editor"][src$="index.js"]');if(!e)throw new Error("Could not find prism-code-editor script element. Ensure the prism-code-editor dependency is properly loaded.");let t=e.getAttribute("src");if(!t)throw new Error("prism-code-editor script element has no src attribute");let i=new URL(t,document.baseURI).href;return U(o,p,i.replace(/\/index\.js$/,"")),m(o,p)},C=new WeakSet,x=function(e){return b(this,null,function*(){var n;if(m(o,w).has(e)||["plain","plaintext","text","txt"].includes(e))return;let t=e;e==="html"&&(t="markup"),yield import(`${h(n=o,f,S).call(n)}/prism/languages/${t}.js`),m(o,w).add(e)})},k=new WeakSet,z=function(e){var d;if(m(o,y).has(e))return;let t=`code-editor-theme-${e}`;if(document.getElementById(t)){m(o,y).add(e);return}let i=h(d=o,f,S).call(d),n=document.createElement("link");n.id=t,n.rel="stylesheet",n.href=`${i}/themes/${e}.css`,n.addEventListener("load",()=>{m(o,y).add(e)}),n.addEventListener("error",()=>{console.error(`Failed to load code editor theme: ${e}`)}),document.head.appendChild(n)},g(a,f),g(a,C),g(a,k),a.tagName="bslib-code-editor",a.isShinyInput=!0,a.observedAttributes=["language","readonly","line-numbers","word-wrap","tab-size","insert-spaces","theme-light","theme-dark"],g(a,w,new Set),g(a,y,new Set),g(a,p,null);customElements.define(a.tagName,a);window.Shiny&&B(a.tagName);export{a as BslibCodeEditor};
//# sourceMappingURL=code-editor.min.js.map
