---
title: "Introduction to Fillabilty"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  echo = FALSE,
  comment = "#>"
)

library(bslib)
library(htmltools)
```

```{r setup-functions}
fillable_container <- function(..., tooltip = NULL, resizable = FALSE, padding = TRUE) {
  gap <- "0.25rem"
  card(
    "data-bs-toggle" = if (!is.null(tooltip)) "tooltip",
    "data-bs-title" = paste(tooltip, collapse = "<br>"),
    "data-bs-html" = "true",
    "data-bs-placement" = "top",
    "data-bs-custom-class" = "tip-pink",
    style = css(
      "--bs-card-border-color" = "var(--bs-pink)",
      "--bs-card-border-width" = "0.12rem",
      gap = if (padding) gap,
      resize = if (resizable) "vertical"
    ),
    ...,
    wrapper = function(...) {
      card_body(
        class = if (padding) "p-1" else "p-0",
        gap = if (padding) gap,
        ...
      )
    }
  )
}


child <- function(..., fill = TRUE, fillable = FALSE, tooltip = NULL, height = 400) {
  both <- fill && fillable
  color <- if (both) "purple" else if (fill) "blue" else "orange"
  div(
    class = "border border-1 border-dark rounded text-center",
    class = paste0("bg-fill-", color),
    "data-bs-toggle" =  if (!is.null(tooltip)) "tooltip",
    "data-bs-title" = paste(tooltip, collapse = "<br>"),
    "data-bs-html" = "true",
    #"data-bs-placement" = if (both || neither) "left" else "right",
    "data-bs-placement" = "right",
    "data-bs-custom-class" = paste0("tip-", color),
    style = css(
      color = "white",
      "--bs-tooltip-bg" = sprintf("var(--bs-%s)", color),
      height = validateCssUnit(height),
      flex_shrink = if (!fill) 0,
      padding = "0.2rem"
    ),
    ...
  ) |>
    bindFillRole(item = fill, container = fillable)
}
```

```{scss, echo = FALSE}
.tip-pink {
  --bs-tooltip-bg: var(--bs-pink);
}
.tip-blue {
  --bs-tooltip-bg: var(--bs-blue);
}
.tip-orange {
  --bs-tooltip-bg: var(--bs-orange);
}
.tip-purple {
  --bs-tooltip-bg: var(--bs-purple);
}

.b-pink {
	font-weight: bold;
	color: var(--bs-pink);
}
.b-orange {
	font-weight: bold;
	color: var(--bs-orange);
}
.b-blue {
	font-weight: bold;
	color: hsl(202deg, 100%, 38%);
}
.b-purple {
  font-weight: bold;
  color: var(--bs-purple);
}

.bg-fill-blue {
	background-image: linear-gradient(
    180deg,
    hsl(202deg, 100%, 38%) 0%,
    hsl(206deg, 58%, 55%) 25%,
    hsl(206deg, 58%, 66%) 50%,
    hsl(205deg, 61%, 77%) 75%,
    hsl(203deg, 69%, 87%) 100%
  );
}

.bg-fill-orange {
  background-image: linear-gradient(
    180deg,
    hsl(27deg, 98%, 54%) 0%,
    hsl(27deg, 97%, 64%) 25%,
    hsl(27deg, 93%, 73%) 50%,
    hsl(28deg, 79%, 82%) 75%,
    hsl(28deg, 27%, 90%) 100%
  );
}

.bg-fill-purple {
  background: var(--bs-purple);
}

```

## Fundamentals

This section covers the building blocks of filling layouts: **fillable container**s and **fill item**s. Keep in mind, most bslib components, as well as many Shiny outputs (e.g., `shiny::plotOutput()`, `plotly::plotlyOutput()`, etc) classify as **fill item**s by default. As we'll learn, that means these UI elements have the potential to grow/shrink to fit their container, but that potential is only activated when their _immediate parent_  is a [fillable container]{.b-pink} _with a defined height_. 

### Activating fill

::: row
::: col-md-6
Just like any other HTML **container**, a [fillable container]{.b-pink}'s default height depends on the height of it's children. So, for example, if there's a single [fill item]{.b-blue} with a defined height of `400px` (the default for most Shiny outputs), the [fillable container]{.b-pink}'s height is also `400px` (plus any padding, border, etc).
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = c("Fillable container", "Computed height: 400px"),
  child(
    tooltip = c("Fill child", "Defined height: 400px")
  )
)
```
:::
:::


::: {.row .mt-3}
::: col-md-6
Defining the height of a [fillable container]{.b-pink} activates its immediate children's potential to [fill]{.b-blue}. So, for example, if [fillable container]{.b-pink}'s height is set to `200px`, the [fill child]{.b-blue} would shrink to about `200px`:
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = c("Fillable", "Defined height: 200px"),
  child(
    tooltip = c("Fill", "Defined height: 400px", "Computed height: 200px")
  ),
  height = 200
)
```
:::
:::


::: {.row .mt-3}
::: col-md-6
If multiple [fill items]{.b-blue} were immediate children of this [fillable container]{.b-pink}, they'd keep shrinking (in this case, to about `100px` each):
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = c("Fillable", "Defined height: 200px"),
  child(
    tooltip = c("Fill", "Defined height: 400px", "Computed height: 100px")
  ), 
  child(
    tooltip = c("Fill", "Defined height: 400px", "Computed height: 100px")
  ),
  height = 200
)
```
:::
:::


::: {.row .mt-3}
::: col-md-6
Adding a [non-fill]{.b-orange} item (e.g., `htmltools::p()`-aragraph of text) won't cause that particular item to grow/shrink, but the [fill]{.b-blue} items divvy up any remaining space (**careful:** if [non-fill]{.b-orange} item(s) are larger than the [fillable container]{.b-pink}, the [fill]{.b-blue} items won't be visible!).

> TODO: explain options for setting min-height?
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = c("Fillable container"),
  child(tooltip = "Fill"), 
  child(tooltip = "Fill"),
  child(
    fill = FALSE, height = 100,
    tooltip = "Non-fill"
  ), 
  height = 200,
  resizable = TRUE
)
```
:::
:::


::: {.callout .callout-warning}
<h3 data-toc-skip>Resizable example</h3>


Notice the resizing handle on the lower-right hand corner of the [fillable container]{.b-pink} above. Use it to change the size of the [fillable container]{.b-pink} and compare the behavior between [fill]{.b-blue} and [non-fill]{.b-orange} items.
:::


### Carrying fill

The previous section focuses on the fairly simple case of _one_ parent container. However, in practice, you'll likely be working with multiple levels of parents, which quickly complicates things, especially because:

1. [Fill items]{.b-blue} require their _immediate_ parent to be a [fillable container]{.b-pink} in order to fill.
2. All "raw" HTML tags (e.g., `shiny::div()`, `shiny::p()`, etc.) as well as many Shiny UI elements (e.g., `shiny::wellPanel()`, etc.) are neither [fillable]{.b-pink} nor [fill]{.b-blue} (i.e., we'll call these [non-fill]{.b-orange} elements).


::: {.row .mt-3}
::: col-md-6
As a result, a common way in which (1) breaks down is that a [non-fill]{.b-orange} element, like a `shiny::div()`, comes between [fillable]{.b-pink} and [fill]{.b-blue}. In fact, you'll run into this exact behavior when using `shiny::uiOutput()` to insert a dynamically rendered [fill]{.b-blue} item into a [fillable container]{.b-pink}.
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = "Fillable container",
  child(
    fill = FALSE, 
    tooltip = "Non-fill",
    "data-bs-offset" = "-140,0",
    child(
      tooltip = "Fill",
      "data-bs-offset" = "-100,0"
    )
  ),
  height = 200,
  resizable = TRUE
)
```
:::
:::

::: {.row .mt-3}
::: col-md-6
Assuming the goal is for the [fill item]{.b-blue} to fit the [fillable container]{.b-pink}, it's useful to coerce the [non-fill]{.b-orange} element into both [fill item]{.b-blue} _and_ a [fillable container]{.b-pink}, which we call a [fill carriers]{.b-purple}. Any UI element can be coerced into a [fill carrier]{.b-purple} with `as_fill_carrier()`.
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = "Fillable container",
  child(
    fillable = TRUE,
    tooltip = "Fill carrier",
    "data-bs-offset" = "-40,0",
    child(tooltip = "Fill")
  ),
  height = 200,
  resizable = TRUE
)
```
:::
:::


::: {.row .mt-3}
::: col-md-6
This concept of a [fill carrier]{.b-purple} is especially useful and relevant for [cards](cards.html). In most cases, a [card]{.b-pink} has numerous children like a [header]{.b-orange} and a [body]{.b-purple}, and the body commonly contains [fill item]{.b-blue}(s) (to ensure [fill item]{.b-blue}s )
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = c("<code>card()</code> (fillable container)"),
  child(
    fill = FALSE, height = 50,
    tooltip = "<code>card_header()</code>"
  ), 
  child(
    fillable = TRUE,
    tooltip = "<code>card_body()</code>",
    child(
      tooltip = "Fill",
      "data-bs-offset" = "-30,0"
    )
  ),
  height = 200,
  resizable = TRUE
)
```
:::
:::

::: {.row .mt-3}
::: col-md-6
This is why, when `card()` implicitly wraps non-card items, it wraps them in `card_body()`{.b-purple} and not `card_body_text()`{.b-blue}. You might wonder, why does `card_body_text()` exist at all? The main reason is that [fillable containers]{.b-pink} are powered by [CSS flexbox](#flexbox), which changes the way in which it's children are rendered. And, although those changes are great for "stretchy" children, there are downsides for providing textual content.
:::

::: col-md-6
```{r}
fillable_container(
  tooltip = c("<code>card()</code> (fillable container)"),
  child(
    fill = FALSE, height = 50,
    tooltip = "<code>card_header()</code> (not fill)"
  ), 
  child(
    fill = TRUE, 
    tooltip = "<code>card_body()</code> (fill)",
    child(
      tooltip = "Fill",
      "data-bs-offset" = "-100,0"
    )
  ),
  height = 200,
  resizable = TRUE
)
```
:::
:::

### Don't use `fluidRow()`



### Fillable = Flexbox {#flexbox}

In order to activate and carry fill, it's useful to 


<!-- Extra js bits --->

```{=html}
<script>
const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle=\"tooltip\"]')
const tooltipList = [...tooltipTriggerList].map(el => {
  new bootstrap.Tooltip(el, {
    trigger: 'hover'
  })
})
</script>
```
